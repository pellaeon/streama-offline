//# sourceMappingURL=streama-video-player-directive.js.map
angular.module("streama").directive("streamaVideoPlayer",["uploadService","apiService","localStorageService","$timeout","playerService","$http","$sce","modalService",function(R,z,e,f,A,B,C,D){return{restrict:"AE",templateUrl:"/streama/streama-video-player.htm",scope:{options:"="},link:function(a,g,r){function t(){a.isInitialized=!0;g.addClass("nocursor");E();F();G();a.isMobile=!1;if(/(android|bb\d+|meego).+mobile|avantgo|bada\/|blackberry|blazer|compal|elaine|fennec|hiptop|iemobile|ip(hone|od)|ipad|iris|kindle|Android|Silk|lge |maemo|midp|mmp|netfront|opera m(ob|in)i|palm( os)?|phone|p(ixi|re)\/|plucker|pocket|psp|series(4|6)0|symbian|treo|up\.(browser|link)|vodafone|wap|windows (ce|phone)|xda|xiino/i.test(navigator.userAgent)||
/1207|6310|6590|3gso|4thp|50[1-6]i|770s|802s|a wa|abac|ac(er|oo|s\-)|ai(ko|rn)|al(av|ca|co)|amoi|an(ex|ny|yw)|aptu|ar(ch|go)|as(te|us)|attw|au(di|\-m|r |s )|avan|be(ck|ll|nq)|bi(lb|rd)|bl(ac|az)|br(e|v)w|bumb|bw\-(n|u)|c55\/|capi|ccwa|cdm\-|cell|chtm|cldc|cmd\-|co(mp|nd)|craw|da(it|ll|ng)|dbte|dc\-s|devi|dica|dmob|do(c|p)o|ds(12|\-d)|el(49|ai)|em(l2|ul)|er(ic|k0)|esl8|ez([4-7]0|os|wa|ze)|fetc|fly(\-|_)|g1 u|g560|gene|gf\-5|g\-mo|go(\.w|od)|gr(ad|un)|haie|hcit|hd\-(m|p|t)|hei\-|hi(pt|ta)|hp( i|ip)|hs\-c|ht(c(\-| |_|a|g|p|s|t)|tp)|hu(aw|tc)|i\-(20|go|ma)|i230|iac( |\-|\/)|ibro|idea|ig01|ikom|im1k|inno|ipaq|iris|ja(t|v)a|jbro|jemu|jigs|kddi|keji|kgt( |\/)|klon|kpt |kwc\-|kyo(c|k)|le(no|xi)|lg( g|\/(k|l|u)|50|54|\-[a-w])|libw|lynx|m1\-w|m3ga|m50\/|ma(te|ui|xo)|mc(01|21|ca)|m\-cr|me(rc|ri)|mi(o8|oa|ts)|mmef|mo(01|02|bi|de|do|t(\-| |o|v)|zz)|mt(50|p1|v )|mwbp|mywa|n10[0-2]|n20[2-3]|n30(0|2)|n50(0|2|5)|n7(0(0|1)|10)|ne((c|m)\-|on|tf|wf|wg|wt)|nok(6|i)|nzph|o2im|op(ti|wv)|oran|owg1|p800|pan(a|d|t)|pdxg|pg(13|\-([1-8]|c))|phil|pire|pl(ay|uc)|pn\-2|po(ck|rt|se)|prox|psio|pt\-g|qa\-a|qc(07|12|21|32|60|\-[2-7]|i\-)|qtek|r380|r600|raks|rim9|ro(ve|zo)|s55\/|sa(ge|ma|mm|ms|ny|va)|sc(01|h\-|oo|p\-)|sdk\/|se(c(\-|0|1)|47|mc|nd|ri)|sgh\-|shar|sie(\-|m)|sk\-0|sl(45|id)|sm(al|ar|b3|it|t5)|so(ft|ny)|sp(01|h\-|v\-|v )|sy(01|mb)|t2(18|50)|t6(00|10|18)|ta(gt|lk)|tcl\-|tdg\-|tel(i|m)|tim\-|t\-mo|to(pl|sh)|ts(70|m\-|m3|m5)|tx\-9|up(\.b|g1|si)|utst|v400|v750|veri|vi(rg|te)|vk(40|5[0-3]|\-v)|vm40|voda|vulc|vx(52|53|60|61|70|80|81|83|85|98)|w3c(\-| )|webc|whit|wi(g |nc|nw)|wmlb|wonu|x700|yas\-|your|zeto|zte\-/i.test(navigator.userAgent.substr(0,
4)))a.isMobile=!0;a.$on("$destroy",H);a.$on("$stateChangeSuccess",I);f(function(){var b=g.find("video");b.bind("contextmenu",function(){return!1});d=b[0];d.oncanplay=J;d.onwaiting=K;d.onplaying=L;d.onerror=M;d.ontimeupdate=N;d.addEventListener("ended",O);a.scrubberOptions=P();a.volumeScrubberOptions=Q();a.volumeLevel=e.get("volumeLevel")||5;n(a.volumeLevel);if(b=e.get("selectedSubtitleLanguage"))b=_.find(a.options.subtitles,{subtitleSrcLang:b}),l(b);if(b=e.get("selectedVideoFile"))b=_.find(a.options.videoFiles,
{label:b}),u(b);var c=!1;z.settings.list().then(function(b){b.data.forEach(function(a,b,d){"subtitle_auto_load"==a.name&&(c=a.parsedValue)});c&&a.options.subtitles&&(p(),l(a.options.subtitles[0]))});a.options.subtitleSize=e.get("subtitleSize")||"md";a.options.hasCustomSubtitleSize=e.get("hasCustomSubtitleSize")||!1;a.options.customSubtitleSize=e.get("customSubtitleSize")||null})}function P(){return{orientation:"horizontal",min:0,max:255,range:"min",change:function(a,c){angular.element("#playerDurationSlider .ui-slider-handle").blur()},
start:function(){q=!0},stop:function(b,c){q=!1;angular.element("#playerDurationSlider .ui-slider-handle").blur();d.currentTime=c.value;a.currentTime=c.value;a.options.onTimeChange(c,a.videoDuration)}}}function Q(){return{orientation:"vertical",range:"min",change:function(a,c){n(c.value);angular.element("#playerVolumeSlider .ui-slider-handle").blur()},slide:function(a,c){n(c.value);angular.element("#playerVolumeSlider .ui-slider-handle").blur()}}}function n(b){d.volume=b/10;a.options.rememberVolumeSetting&&
e.set("volumeLevel",a.volumeLevel)}function G(){a.$on("triggerVideoPlay",function(b,c){a.play(c)});a.$on("triggerVideoPause",function(b,c){a.pause(c)});a.$on("triggerVideoToggle",function(b,c){a.playing?a.pause(c):a.play(c)});a.$on("triggerVideoTimeChange",function(b,c){d.currentTime=c.currentPlayerTime;a.currentTime=c.currentPlayerTime})}function I(b,c){"player"!=c.name&&(a.isFullScreen=!0,a.fullScreen())}function H(){Mousetrap.reset();console.log("destroy");d.pause();d.src="";g.find("video").children("source").prop("src",
"");g.find("video").remove().length=0}function N(b){if(!q){a.currentTime=d.currentTime;var c=a.options.outro_start;b=_.get(a.options,"nextVideo.id");c?a.isNextVideoShowing=b&&d.currentTime>c:(c=d.duration-d.currentTime,a.isNextVideoShowing=b&&30>c);a.$apply();null==h&&(h=A.getVideoOptions().currentEpisode);h.intro_start<this.currentTime&&this.currentTime<h.intro_end&&(d.currentTime=h.intro_end)}}function O(){if(a.options.showNextButton&&a.options.isAutoplayNextActive)a.options.onNext()}function M(){if(!d.duration&&
!a.initialPlay)a.options.onError()}function L(){a.loading=!1}function J(){a.initialPlay||(a.canplay=!0,console.log("%c oncanplay","color: deeppink; font-weight: bold; text-shadow: 0 0 5px deeppink;"),a.loading=!1,a.isMobile?a.pause():a.play(),a.videoDuration=d.duration,d.currentTime=a.options.customStartingTime||0,a.currentTime=d.currentTime,a.initialPlay=!0,a.options.videoTrack&&(d.textTracks[0].mode="hidden"))}function K(){a.loading=!0}function p(){_.forEach(d.textTracks,function(a,c){a.mode="hidden"});
a.selectedSubtitleId=null;a.selectedLanguage=null}function l(b){(a.options.selectedSubtitle=b)?_.forEach(d.textTracks,function(c,d){c.id!=="subtitle-"+b.id?c.mode="hidden":c.id==="subtitle-"+b.id&&(c.mode="showing",a.selectedLanguage=c.language,a.selectedSubtitleId=b.id,e.set("selectedSubtitleLanguage",c.language))}):p()}function u(b,c){b&&(c&&(a.options.customStartingTime=c),a.initialPlay=!1,a.options.selectedVideoFile=b,a.options.videoSrc=C.trustAsResourceUrl(b.src||b.externalLink),a.options.originalFilename=
b.originalFilename,a.options.videoType=b.contentType,e.set("selectedVideoFile",b.label))}function m(b){a.volumeChanged=!0;f.cancel(v);a.volumeLevel+=b;a.volumeLevel=a.volumeLevel.clamp(0,10);a.$apply();v=f(function(){a.volumeChanged=!1},1500)}function k(){a.currentTimeChanged=!0;a.options.onTimeChange(d.currentTime,a.videoDuration);f.cancel(w);w=f(function(){a.currentTimeChanged=!1},1E4)}function E(){var b=!0;jQuery(g).mousewheel(function(c){b&&(0<c.deltaY?m(1):0>c.deltaY&&m(-1),a.showControls())});
var c=document.querySelector("#player-menu-episode-selector");c&&(c.addEventListener("mouseenter",function(a){b=!1}),c.addEventListener("mouseleave",function(a){b=!0}))}function F(){Mousetrap.bind("left",function(b){b.preventDefault();k();a.$apply();d.currentTime-=20},"keyup");Mousetrap.bind("right",function(b){b.preventDefault();k();a.$apply();d.currentTime+=20},"keyup");Mousetrap.bind("ctrl+right",function(b){b.preventDefault();k();a.$apply();d.currentTime+=60},"keyup");Mousetrap.bind("ctrl+left",
function(b){b.preventDefault();k();a.$apply();d.currentTime-=60},"keyup");Mousetrap.bind("alt+enter",function(b){b.preventDefault();a.fullScreen()});Mousetrap.bind(["backspace","del"],function(b){b.preventDefault();a.closeVideo()});Mousetrap.bind("s",function(b){b.preventDefault();a.toggleTextTrack()});Mousetrap.bind("up",function(a){a.preventDefault();m(1)});Mousetrap.bind("down",function(a){a.preventDefault();m(-1)});Mousetrap.bind("m",function(b){b.preventDefault();a.playerVolumeToggle();a.showControls()});
Mousetrap.bind("e",function(b){b.preventDefault();a.toggleSelectEpisodes();a.showControls()});Mousetrap.bind("space",function(){a.playing?a.pause():a.play();a.$apply()})}var d,x,y,v,w,q=!1,h=null;r=a.options.videoSrc.toString();a.showControls=function(){g.removeClass("nocursor");f.cancel(x);f.cancel(y);a.controlsVisible=!0;a.overlayVisible=!1;x=f(function(){a.controlsVisible=!1;a.playing?g.addClass("nocursor"):y=f(function(){a.playing||(a.overlayVisible=!0)},5E3)},1E3)};a.toggleSelectEpisodes=function(b){a.options.selectedEpisodes=
b};a.createNewPlayerSession=function(){a.options.onSocketSessionCreate()};a.openPlaybackOptions=function(){a.pause();D.openPlaybackOptions(a.options).then(function(b){a.play();b&&(a.options.hasCustomSubtitleSize=b.hasCustomSubtitleSize,a.options.customSubtitleSize=b.customSubtitleSize,a.options.subtitleSize=b.subtitleSize,e.set("subtitleSize",b.subtitleSize),e.set("hasCustomSubtitleSize",b.hasCustomSubtitleSize),e.set("customSubtitleSize",b.customSubtitleSize),_.isEqualBy(b.selectedVideoFile,a.options.selectedVideoFile,
"id")||u(b.selectedVideoFile,d.currentTime),_.isEqualBy(b.selectedSubtitle,a.options.selectedSubtitle,"id")||l(b.selectedSubtitle))})};a.toggleTextTrack=function(){a.isTextTrackVisible=!a.isTextTrackVisible;a.isTextTrackVisible?_.forEach(d.textTracks,function(b,c){a.selectedLanguage?b.language===a.selectedLanguage&&(b.mode="showing"):d.textTracks[0].mode="showing"}):_.forEach(d.textTracks,function(a,c){a.mode="hidden"})};a.selectSubtitle=function(){a.multipleSubtitleBrowser=!a.multipleSubtitleBrowser};
a.changeSubtitle=l;a.hideSubtitle=p;a.playerVolumeToggle=function(){a.volumeLevel=0==a.volumeLevel?5:0};a.play=function(b){d.play();a.playing=!0;a.options.onPlay(d,b);a.overlayVisible=!1};a.pause=function(b){d.pause();a.playing=!1;a.options.onPause(d,b)};a.skip=function(a,c){k();"rewind"===a&&(d.currentTime-=c);"fastForward"===a&&(d.currentTime+=c)};a.closeVideo=function(){1==a.isFullScreen&&a.fullScreen();a.options.onClose()};a.clickVideo=function(){a.options.onVideoClick()};a.fullScreen=function(){var b,
c=document;b=a.isMobile?d:document.documentElement;window.innerHeight!=screen.height?(a.isFullScreen=!0,b.requestFullscreen?b.requestFullscreen():b.mozRequestFullScreen?b.mozRequestFullScreen():b.webkitRequestFullScreen?b.webkitRequestFullScreen():b.msRequestFullscreen&&b.msRequestFullscreen()):(a.isFullScreen=!1,c.exitFullscreen?c.exitFullscreen():c.mozCancelFullScreen?c.mozCancelFullScreen():c.webkitExitFullscreen?c.webkitExitFullscreen():c.msExitFullscreen&&c.msExitFullscreen())};a.getCustomSubtitleSize=
function(){return a.options.hasCustomSubtitleSize?a.options.customSubtitleSize:null};a.next=a.options.onNext;a.isInitialized=!1;a.isNextVideoShowing=!1;a.loading=!0;a.initialPlay=!1;a.options.isExternalLink?t():B.head(r).then(function(){t()},function(b,c){if(406==c)a.options.onError("FILE_IN_FS_NOT_FOUND")})}}}]);
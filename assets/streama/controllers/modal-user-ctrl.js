//# sourceMappingURL=modal-user-ctrl.js.map
angular.module("streama").controller("modalUserCtrl",["$scope","$uibModalInstance","apiService","user","isInvite",function(a,f,d,h,k){a.user=angular.copy(h)||{};a.loading=!1;a.validPassword=k?!0:!1;d.user.availableRoles().then(function(b){a.roles=b.data});a.cancel=function(){f.dismiss("cancel")};a.checkAvailability=function(b){a.error=null;a.validUser=!1;b&&d.user.checkAvailability(b).then(function(b){b=b.data;b.error?a.error=b.error:a.validUser=!0})};a.checkPassword=function(b,c){a.validPassword=
!0;a.passwordValidationError=null;b?6>b.length?(a.passwordValidationError="PASS_ERROR_LENGTH",a.validPassword=!1):b!=c&&(a.passwordValidationError="PASS_ERROR_REPEAT",a.validPassword=!1):(a.passwordValidationError="PASS_ERROR_EMPTY",a.validPassword=!1)};a.checkAuthorities=function(b){return _.some(a.user.authorities,{id:b})};a.toggleAuthorities=function(b){a.user.authorities=_.xorBy(a.user.authorities,[b],"id")};a.toggleSelection=function(a,c){-1<c.indexOf(a)?c.splice(c.indexOf(a),1):c.push(a)};a.saveAndInviteUser=
function(b){a.loading=!0;var c=angular.copy(b);d.user.saveAndInviteUser(c).then(function(c){var e=c.data;b.id?(alertify.success("User Updated!"),f.close(e),a.loading=!1):d.profile.save({profileName:e.username,profileLanguage:e.language,isChild:!1,user:e}).then(function(){alertify.success("Profile Created!");f.close(e);a.loading=!1},function(b){alertify.error(b.message);a.loading=!1})},function(b){a.loading=!1;_.get(b,"errors")?_.forEach(b.errors,function(a){alertify.error("Error: "+a.message)}):alertify.error("There was an error saving the user.")})};
a.saveAndCreateUser=function(b){a.loading=!0;b=angular.copy(b);d.user.saveAndCreateUser(b).then(function(b){var g=b.data;d.profile.save({profileName:g.username,profileLanguage:g.language,isChild:!1,user:g}).then(function(){alertify.success("Profile Created!");f.close(g);a.loading=!1},function(b){alertify.error(b.message);a.loading=!1})},function(){a.loading=!1;alertify.error("There was an error saving the user.")})}}]);
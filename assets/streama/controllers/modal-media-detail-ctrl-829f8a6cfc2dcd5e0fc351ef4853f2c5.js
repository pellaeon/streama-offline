//# sourceMappingURL=modal-media-detail-ctrl.js.map
angular.module("streama").controller("modalMediaDetailCtrl",["$scope","$uibModalInstance","$rootScope","config","$state","apiService",function(b,g,k,c,d,e){var h;b.mediaType=c.mediaType;var f=c.mediaId;b.isEditButtonHidden=c.isEditButtonHidden;b.listEpisodesForSeason=function(a){return _.filter(b.episodes,{season_number:a})};b.addToWatchlist=function(a){e.watchlistEntry.create(a).then(function(a){a=a.data;b.media=a.video?a.video:a.tvShow;b.watchlistEntry=a;h="added"})};b.removeFromWatchlist=function(a){alertify.set({buttonReverse:!0,
labels:{ok:"Yes",cancel:"Cancel"}});alertify.confirm("Are you sure you want to remove this video from your watchlist?",function(l){l&&e.watchlistEntry.delete(a).then(function(a){b.media=a.data;h="removed"})})};c.mediaObject?(b.media=c.mediaObject,b.isApiMovie=c.isApiMovie):f&&b.mediaType?(console.log("%c media","color: deeppink; font-weight: bold; text-shadow: 0 0 5px deeppink;",f),e[b.mediaType].get(f).then(function(a){b.media=a.data;"tvShow"==b.mediaType&&(b.currentSeason=0,e.tvShow.episodesForTvShow(b.media.id).then(function(a){a=
b.episodes=a.data;a.length&&(b.seasons=_.chain(a).map("season_number").uniq().value(),b.currentSeason=_.min(a,"season_number").season_number)}),e.dash.firstEpisodeForShow(b.media.id).then(function(a){b.firstEpisode=a.data}))})):c.mediaObject||f||b.mediaType||alertify.error("No data available");b.cancel=function(){g.close({watchlistEntry:b.watchlistEntry,video:b.media,action:h});"dash"===d.current.name&&d.go("dash",{mediaModal:null,mediaType:null})};b.setCurrentSeason=function(a){b.currentSeason=a};
b.editMedia=function(a){k.currentUser.isContentManager&&(console.log("%c media","color: deeppink; font-weight: bold; text-shadow: 0 0 5px deeppink;",a),a.isGenericVideo&&d.go("admin.video",{videoId:a.id}),a.title?d.go("admin.movie",{movieId:a.id}):a.name&&d.go("admin.show",{showId:a.id}),g.dismiss("cancel"))};b.$on("$stateChangeStart",function(){g.dismiss("cancel")})}]);
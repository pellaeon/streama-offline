//# sourceMappingURL=settings-settings-ctrl.js.map
angular.module("streama").controller("settingsSettingsCtrl",["$scope","apiService","$sce","uploadService",function(b,c,e,f){b.bigLoading=!1;b.loading=!0;b.syncImages=function(){alertify.set({buttonReverse:!0,labels:{ok:"Yes",cancel:"Cancel"}});alertify.confirm("Are you sure, you want to sync all images? This might take a while. (check the server logs for status updates)",function(a){a&&(b.bigLoading=!0,c.theMovieDb.checkAndFixImageIntegrity().then(function(){b.bigLoading=!1}))})};c.settings.list().then(function(a){a=
a.data;b.settings=a;_.forEach(a,function(a){a.description=e.trustAsHtml(Autolinker.link(a.description,{newWindow:"true"}))});b.loading=!1});b.updateMultipleSettings=function(a){a.invalid=!1;c.settings.updateMultiple(a).then(function(){window.location.reload();alertify.success("Settings saved.")})};b.validateSettings=function(a){!0!==b.loading&&(b.changeValue(a),b.loading=!0,c.settings.validateSettings(a).then(function(d){alertify.success(d.data.message||"validation successful");a.valid=!0;b.loading=
!1},function(d){alertify.error(d.data.message);a.invalid=!0;b.loading=!1}))};b.changeValue=function(a){!1===a.validationRequired?(a.valid=!0,a.invalid=!1):(a.valid=void 0,a.invalid=void 0,a.dirty=a.value)};b.uploadStatus={};b.upload=function(a,d){c.settings.list().then(function(c){_.find(c.data,{settingsKey:"Upload Directory"}).value?f.doUpload(b.uploadStatus,"file/upload.json?isPublic=true",function(d){b.uploadStatus.percentage=null;d.error||(a.value="upload:"+d.id,b.getAssetFromSetting(a))},function(){},
d):alertify.error("You have to set and save Upload Directory first")})};b.getAssetFromSetting=function(a){if("undefined"===typeof a)return!1;var b=a.value;if(b!==a.prevValue)if(a.prevValue=b,b.startsWith("upload:"))b=b.split(":")[1],c.file.getURL(b).then(function(b){a.src=b.data.url;return!0});else return a.src=b,!0;else return!0};b.anySettingsInvalid=function(){return _.find(b.settings,function(a){return!1!==a.validationRequired&&(a.invalid||a.dirty&&!a.valid||!a.value&&a.required)})};b.resetBaseURL=
function(a){a.value="http://localhost:8080";a.valid=!0}}]);
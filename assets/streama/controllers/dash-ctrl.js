//# sourceMappingURL=dash-ctrl.js.map
angular.module("streama").controller("dashCtrl",["$scope","apiService","$state","$rootScope","localStorageService","modalService","$stateParams","mediaListService","currentUser",function(n,c,k,f,r,p,g,l,m){function t(){if(d("home")||d("discover-movies"))b.movie=l.init(c.dash.listMovies,{sort:"title",order:"ASC"},m);if(d("home")||d("discover-shows"))b.tvShow=l.init(c.dash.listShows,{sort:"name",order:"ASC"},m);if(d("home")||d("watchlist"))b.watchlistEntry=l.init(c.watchlistEntry.list,{sort:"id",order:"DESC"},
m);d("home")&&(b.genericVideo=l.init(c.dash.listGenericVideos,{sort:"title",order:"ASC"},m),c.dash.listNewReleases().then(w),c.dash.listContinueWatching().then(x),c.dash.listRecommendations().then(y));c.dash.listGenres().then(z);c.tag.list().then(A)}function d(a){return k.params.dashType===a||"home"===a&&!k.params.dashType}function y(a){b.recommendations=a.data;b.loadingRecommendations=!1}function x(a){b.continueWatching=a.data}function w(a){b.newReleases=a.data}function A(a){b.tags=a.data}function z(a){a=
a.data;f.genres=a;g.genreId&&(f.selectedGenre=_.find(a,{id:parseInt(g.genreId)}),b.movie.filter.genre=[f.selectedGenre],b.tvShow.filter.genre=[f.selectedGenre])}function B(){var a=c.settings.list();a.then(function(a){a=a.data;n.settings=a;_.find(a,{settingsKey:"Upload Directory"}).value||alertify.alert("You need to fill out some required base-settings. You will be redirected to the settings page now.",function(){k.go("settings.settings")})});return a}function u(a){c.watchlistEntry.create(a).then(function(e){b.watchlistEntry.list=
b.watchlistEntry.list?b.watchlistEntry.list:[];q("added",b.watchlistEntry.list,a,e.data)})}function v(a){alertify.set({buttonReverse:!0,labels:{ok:"Yes",cancel:"Cancel"}});alertify.confirm("Are you sure you want to remove this video from your watchlist?",function(e){e&&c.watchlistEntry.delete(a).then(function(e){q("removed",b.watchlistEntry.list,a)})})}function q(a,b,c,f){var d=C(c);"added"===a?(b.push(f),alertify.success("The "+d+" was added to your watchlist.")):"removed"===a&&(D(b,c),alertify.success("The "+
d+" was removed from your watchlist."));b.sort(function(a,b){return a.id<b.id?1:a.id>b.id?-1:0})}function D(a,b){_.remove(a,function(a){return(a.video?a.video.id:a.tvShow.id)===b.id})}function C(a){var e=a.mediaType;switch(e){case "tvShow":h(b.tvShow.list,a);e="show";break;case "movie":h(b.movie.list,a);e="movie";break;case "genericVideo":h(b.genericVideo.list,a),e="video"}h(b.newReleases,a);h(b.continueWatching,a);return e}function h(a,b){var c=_.findIndex(a,function(a){return b.id===a.id});0<c&&
(a[c].inWatchlist=!a[c].inWatchlist)}var b=this;b.fetchFirstEpisodeAndPlay=function(a){c.dash.firstEpisodeForShow(a.id).then(function(a){k.go("player",{videoId:a.data.id})})};b.showDetails=function(a){"episode"===a.mediaType?p.mediaDetailModal({mediaId:a.tvShowId,mediaType:"tvShow",isApiMovie:!1}):p.mediaDetailModal({mediaId:a.id,mediaType:a.mediaType,isApiMovie:!1},function(e){q(e.action,b.watchlistEntry.list,a,e.watchlistEntry)})};b.handleWatchlistUpdate=function(a,b){switch(a){case "added":u(b);
break;case "removed":v(b)}};b.addToWatchlist=u;b.removeFromWatchlist=v;b.markCompleted=function(a){alertify.set({buttonReverse:!0,labels:{ok:"Yes",cancel:"Cancel"}});alertify.confirm("Are you sure you want to mark this video as completed?",function(e){e&&c.viewingStatus.delete(a.id).then(function(c){_.remove(b.continueWatching,{id:a.id})})})};b.loadingRecommendations=!0;b.isDashSectionHidden=function(a){var b=_.find(n.settings,{name:"hidden_dash_sections"});if(_.get(b,"parsedValue"))return-1<b.parsedValue.split(",").indexOf(a)};
b.isDashType=d;n.$on("changedGenre",function(a,c){f.selectedGenre=c;var d;d=f.selectedGenre?[f.selectedGenre.id]:[];b.movie.filter.genre=d;b.tvShow.filter.genre=d;b.movie.setFilter();b.tvShow.setFilter()});(function(){f.currentUser.isAdmin&&B();g.mediaModal&&p.mediaDetailModal({mediaId:g.mediaModal,mediaType:g.mediaType,isApiMovie:!1});r.get("currentProfile")?t():c.profile.getUserProfiles().then(function(a){r.set("currentProfile",a.data[0]);t()},function(a){alertify.error(a.message)})})()}]);
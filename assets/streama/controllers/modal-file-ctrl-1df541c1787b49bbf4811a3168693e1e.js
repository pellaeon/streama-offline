//# sourceMappingURL=modal-file-ctrl.js.map
angular.module("streama").controller("modalFileCtrl",["$scope","$uibModalInstance","apiService","uploadService","video","localStorageService","$rootScope",function(a,f,c,g,h,d,m){function k(a){a._isEditing=!a._isEditing}a.loading=!1;a.localFilesEnabled=!1;a.localFiles=[];a.activeTab=d.get("activeFileModalTab")||"upload";a.closeOnSelect=d.get("fileModal.closeOnSelect");null==a.closeOnSelect&&(a.closeOnSelect=!0);var l=d.get("localFileLastPath")||"";a.localDir=l.split("/")||[];a.video=h;a.uploadStatus=
{};a.upload=g.doUpload.bind(g,a.uploadStatus,"video/uploadFile.json?id="+h.id,function(b){a.uploadStatus.percentage=null;b.error||(".srt"==b.extension||".vtt"==b.extension?(a.video.subtitles=a.video.subtitles||[],a.video.subtitles.push(b),a.video.hasFiles=!0,alertify.success("Subtitles uploaded successfully.")):(a.video.videoFiles=a.video.videoFiles||[],a.video.videoFiles.push(b),a.video.hasFiles=!0,alertify.success("Video uploaded successfully.")))},function(){});a.loadLocalFiles=function(b){_.get(m.getSetting("Local Video Files"),
"value")&&c.file.localFiles(b).then(function(e){d.set("localFileLastPath",b);a.localFilesEnabled=!0;a.localFiles=e.data},function(b){"LocalFilesNotEnabled"==b.code?a.localFilesEnabled=!1:alertify.error(b.message)})};a.backLocalDirectory=function(){a.localFiles=[];a.localDir.pop();a.loadLocalFiles(a.localDir.join("/"))};a.openLocalDirectory=function(b){a.localFiles=[];a.localDir.push(b.name);a.loadLocalFiles(a.localDir.join("/"))};a.toggleCloseOnSelect=function(){a.closeOnSelect=!a.closeOnSelect;d.set("fileModal.closeOnSelect",
a.closeOnSelect)};a.addLocalFile=function(b){c.video.addLocalFile({id:a.video.id,localFile:b}).then(function(b){b=b.data;alertify.success("Local File Added.");a.video.localFile=null;_.find(a.video.videoFiles,{id:b.id})?a.video.videoFiles[_.indexOf(a.video.videoFiles,{id:b.id})]=b:(a.video.videoFiles=a.video.videoFiles||[],a.video.videoFiles.push(b),a.video.hasFiles=!0);a.closeOnSelect&&f.dismiss("cancel")},function(a){alertify.error(a.message)})};a.cancel=function(){f.dismiss("cancel")};a.removeFile=
function(b){alertify.set({buttonReverse:!0,labels:{ok:"Yes",cancel:"Cancel"}});alertify.confirm('Are you sure you want to remove the file "'+b.originalFilename+'"?',function(e){e&&c.video.removeFile(a.video.id,b.id).then(function(){".srt"==b.extension||".vtt"==b.extension?(_.remove(a.video.subtitles,{id:b.id}),alertify.success("Subtitles deleted.")):(_.remove(a.video.videoFiles,{id:b.id}),alertify.success("Video deleted."))})})};a.saveChanges=function(a){c.file.save(a).then(function(e){alertify.success("File successfully saved.");
k(a)})};a.getFilesForExtensions=function(b){return _.filter(a.video.videoFiles,function(a){return-1<b.indexOf(a.extension.toLowerCase())})};a.addExternalUrl=function(b){c.video.addExternalUrl({id:a.video.id,externalUrl:b}).then(function(b){alertify.success("External URL Added.");a.video.externalLink=null;_.find(a.video.videoFiles,{id:b.data.id})?a.video.videoFiles[_.indexOf(a.video.videoFiles,{id:data.id})]=b.data:(a.video.videoFiles=a.video.videoFiles||[],a.video.videoFiles.push(data),a.video.hasFiles=
!0)})};a.toggleEdit=k;a.isEditing=function(a){return a._isEditing};a.loadLocalFiles(l);a.$watch("activeTab",function(a,c){d.set("activeFileModalTab",a)})}]);